FROM registry.fedoraproject.org/fedora:latest

RUN mkdir -p /srv/media && \
    mkdir -p /srv/public && \
    mkdir -p /srv/share/iso

RUN set -x && \
    dnf -y update && \
    dnf install -y samba && \
    dnf clean all && \
    rm -rf /var/cache/yum /var/cache/dnf

COPY smb.conf /etc/samba/smb.conf

EXPOSE 445

WORKDIR /home/share/

RUN chown -R 1024 /srv/media && \
    chown -R 1024 /srv/public && \
    chown -R 1024 /srv/share

USER 1024

ENTRYPOINT ["/usr/sbin/smbd", "-F", "--no-process-group", "-s", "/etc/samba/smb.conf"]
